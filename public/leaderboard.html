<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ranking — IngresoU</title>
  <link rel="stylesheet" href="/assets/styles.css"/>
</head>
<body>
<header class="header">
  <div class="container row">
    <div class="brand">IngresoU</div>
    <nav class="nav">
      <a href="/index.html">Inicio</a>
      <a href="/premium.html">Premium</a>
      <a class="active" href="/leaderboard.html">Ranking</a>
      <a href="/exam.html">Examen</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="section">
    <div class="card pad">
      <div class="sec-head">
        <h2>Ranking nacional</h2>
        <span class="pill">Top 50 — mayor puntaje y menor tiempo</span>
      </div>
      <div id="lb-wrap" class="sec">
        <div class="inline-note">Cargando ranking…</div>
      </div>
    </div>

    <div class="card pad" style="margin-top:16px;">
      <div class="sec-head">
        <h3>Consejo</h3>
        <span class="pill">Tu racha y XP te ayudan a subir</span>
      </div>
      <p class="p">Tu cuenta guarda <b>racha</b> y <b>XP</b>. No compartas tu cuenta: podría <u>romper tu racha</u> y afectar tu progreso y ranking.</p>
      <div class="row" style="gap:10px;">
        <a class="btn" href="/practice-algebra.html">Practicar Álgebra</a>
        <a class="btn" href="/exam.html?mode=paa">Hacer simulacro PAA</a>
      </div>
    </div>
  </section>
</main>

<script>
async function loadLB(){
  const el = document.getElementById('lb-wrap');
  try{
    const r = await fetch('/api/leaderboard');
    const j = await r.json();
    if(!j.ok){ el.innerHTML = '<div class="inline-note bad">No hay datos por ahora.</div>'; return; }
    const rows = j.items||[];
    if(!rows.length){ el.innerHTML = '<div class="inline-note">Aún no hay puntajes. ¡Sé el primero!</div>'; return; }

    const me = (localStorage.getItem('ingresou_email')||'').toLowerCase();
    let html = `<div class="table-wrap"><table class="table">
      <thead><tr><th>#</th><th>Email</th><th>Tema</th><th>Puntaje</th><th>Tiempo</th><th>Fecha</th></tr></thead><tbody>`;
    rows.forEach((r,i)=>{
      const meRow = me && r.email.toLowerCase()===me ? ' style="background:rgba(59,178,246,.08)"' : '';
      html += `<tr${meRow}>
        <td>${i+1}</td>
        <td>${r.email.replace(/(.{2}).+(@)/,'$1***$2')}</td>
        <td>${r.topic}</td>
        <td><b>${r.score}</b></td>
        <td>${Math.round((r.duration||0)/60)}m</td>
        <td>${(r.created_at||'').slice(0,10)}</td>
      </tr>`;
    });
    html += '</tbody></table></div>';
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = '<div class="inline-note bad">Error cargando ranking.</div>';
  }
}
document.addEventListener('DOMContentLoaded', loadLB);
</script>

<script src="/assets/onboarding.js"></script>
</body>
</html>

